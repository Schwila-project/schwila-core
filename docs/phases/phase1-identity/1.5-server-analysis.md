# ğŸ§  1.5 - ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ù„Ø¬Ù„Ø³Ø© (Server-Side Session Analysis)

## ğŸ¯ Ø§Ù„Ù‡Ø¯Ù
ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ø²Ø§Ø¦Ø± (Ø§Ù„Ø¨ØµÙ…Ø©ØŒ Ø§Ù„Ø³Ù„ÙˆÙƒØŒ sessionId) Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…ØŒ ÙˆÙ…Ù‚Ø§Ø±Ù†ØªÙ‡Ø§ Ù…Ø¹ Ø¬Ù„Ø³Ø§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø²Ø§Ø¦Ø± Ù…Ø¹Ø±ÙˆÙÙ‹Ø§ Ø£Ùˆ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ Ø£Ùˆ Ø´Ø¨Ù‡ Ù…Ø¹Ø±ÙˆÙ.

---

## ğŸ§ª Ø§Ù„ÙØ±Ø¶ÙŠØ©
Ù…Ù† Ø®Ù„Ø§Ù„ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØ§Ù„Ø³Ù„ÙˆÙƒ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²Ù†Ø© Ù…Ø¤Ù‚ØªÙ‹Ø§ ÙÙŠ RedisØŒ ÙŠÙ…ÙƒÙ† ØªØµÙ†ÙŠÙ Ø§Ù„Ø²Ø§Ø¦Ø± Ø¨Ø¯Ù‚Ø© Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø£ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„.

---

## âš™ï¸ Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„

1. Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† `/identify`
2. Ø§Ø³ØªØ®Ø±Ø§Ø¬ `fingerprint`, `session_id`, `behavior`
3. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Redis Ø¹Ù† Ø¬Ù„Ø³Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ù„Ø¨ØµÙ…Ø©
4. Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„ØªØ´Ø§Ø¨Ù‡ (score) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰:
   - ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨ØµÙ…Ø©
   - ØªØ´Ø§Ø¨Ù‡ Ø§Ù„Ø³Ù„ÙˆÙƒ
   - ØªÙƒØ±Ø§Ø± Ø§Ù„Ø²ÙŠØ§Ø±Ø©
5. ØªØµÙ†ÙŠÙ Ø§Ù„Ø²Ø§Ø¦Ø±:
   - `known`: ØªØ·Ø§Ø¨Ù‚ ØªØ§Ù…
   - `partially_known`: ØªØ·Ø§Ø¨Ù‚ Ø¬Ø²Ø¦ÙŠ
   - `new`: Ù„Ø§ ØªØ·Ø§Ø¨Ù‚

---

## ğŸ’» ÙƒÙˆØ¯ Ù…Ø¨Ø¯Ø¦ÙŠ (server/api/identify.js)

```js
app.post('/identify', async (req, res) => {
  const { session_id, fingerprint, behavior } = req.body;

  // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ù† Redis
  const previous = await redis.get(`fp:${fingerprint}`);

  let score = 0;
  if (previous) {
    const prevData = JSON.parse(previous);
    // Ù…Ø«Ø§Ù„ Ø¨Ø³ÙŠØ· Ù„Ø­Ø³Ø§Ø¨ score
    score += fingerprint === prevData.fingerprint ? 50 : 0;
    score += compareBehavior(behavior, prevData.behavior); // ØªØ±Ø¬ÙŠØ­ Ø³Ù„ÙˆÙƒÙŠ
  }

  const classification = score >= 80 ? 'known'
                      : score >= 40 ? 'partially_known'
                      : 'new';

  // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  await redis.set(`session:${session_id}`, JSON.stringify({ fingerprint, behavior }), 'EX', 3600);
  await redis.set(`fp:${fingerprint}`, JSON.stringify({ fingerprint, behavior }), 'EX', 86400);

  res.json({ session_id, fingerprint, score, classification });
});
